# 汉化教程加强版

## 开发工具选择

### IDE工具

适合的IDE工具还是有很多的，比如idea、vscode、sublime等。工具选择这一块看个人的喜好，不管是idea还是vscode，我之前的视频都用过。我个人比较喜欢用idea，毕竟这是一个java项目，用idea更加方便。

### WZ工具

HaRepacker - 查看和编辑wz的工具

HaSuite - 里面包含HaRepacker和HaCreator



## 基本原理

### 代码结构

heaven-ms-nap

- cores  java代码依赖包

- dist  jar包打包生成位置

- docs  文档目录

- packfiles  打包exe的配置文件

- scripts  核心，所有的js脚本所在目录

- sql  数据库初始化脚本

- src  核心，java源码

- tools  一些未编译成界面的工具

- wz  核心，与客户端wz对应的xml文件

- 工具  一些常用的工具

- config.yaml  核心，服务启动的配置文件

- docker-compose.yml、Dockerfile  docker部署脚本

- *.bat  windows启动脚本

- *.sh  linux启动脚本

### 交互讲解

我们安装的很多应用程序，正常来说有一个叫resources的资源文件夹，里面存放着应用的图片、图标、音频、视频、样式、布局等等文件。大多数程序我们进入就能一眼看到资源文件长什么样子，但有一些程序会将资源文件进行压缩或加密，不借助一些工具，我们看不到资源文件的内容。

冒险岛也有对应的资源文件，里面包含图片、对话、NPC信息、地图信息、任务信息等等资源，在客户端程序启动后会加载这些资源展现成界面给我们看。冒险岛的资源文件就是.wz结尾的文件。

我们在游戏的过程中，有一些信息需要请求服务端获取，比如对怪物造成伤害、接任务、交易、拾取物品等等。有一些则不用，比如与某些NPC对话、查看物品信息等等。拿微信来说，即便我们断网了，我们还是能查看和别人聊天的历史信息，但是收发消息必须得联网请求服务端是一样的道理。

我们拿到手的客户端已经是汉化过后的，汉化率基本达到了90%以上，而服务端基本上是英文。所以在一些不请求服务端的情况下，我们的界面展示的中文。请求服务端后，界面收到服务端的响应又展示成了英文。而我们大部分与服务端交互后，需要展示在界面上的东西基本上是对话脚本，所以我们要做的主要工作就是将服务端的脚本进行汉化。



## 汉化流程

正常的脚本，我们只需要把英文翻译成中文即可。碰到一些场景，可能还需要对汉化的脚本结合游戏场景进行微调。但很多时候，汉化脚本没有那么简单，所以就有了本期视频。

说了这么多，下面结合一个例子进行实战。

### 准备工作

脚本标记符参考文档：[脚本标记符](%E8%84%9A%E6%9C%AC%E6%A0%87%E8%AE%B0%E7%AC%A6.md)

之前的汉化视频：https://www.bilibili.com/video/BV133411o7Nj/?p=2

脚本引擎：https://www.bilibili.com/video/BV133411o7Nj?p=4

### 打开DEBUG模式

在config.yaml中，找到server.USE_DEBUG，配置成true。启动服务端后，就开启了debug模式。

### 与NPC对话

找到想要汉化的NPC，与NPC对话，这时候查看消息栏，如果是服务端脚本，这个时候会打印NPC的id，通过id找到对应的js脚本。

### 脚本标记符

这个之前的视频有讲过

### 调用java方法

这个之前的视频也有讲过，调用的方法在NPCConversationManager.java类和他的父类AbstractPlayerInteraction.java里面找。一般望文生义，有一些命名不太懂的要看源码。

### 名称翻译

这个要结合wz一起来看，主要是String.wz。因为客户端是已经汉化过的，所以找到对应的id后，看客户端怎么翻译的，结合客户端的翻译来翻译。如果客户端汉化是错的，那么客户端和服务端都需要改。不建议把服务端的改掉，因为下次再查wz时，可能找不到对应的id了。
